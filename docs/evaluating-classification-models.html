<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Topic 12 Evaluating Classification Models | STAT 253: Statistical Machine Learning</title>
  <meta name="description" content="This is the class website for Statistical Machine Learning at Macalester College." />
  <meta name="generator" content="bookdown 0.23 and GitBook 2.6.7" />

  <meta property="og:title" content="Topic 12 Evaluating Classification Models | STAT 253: Statistical Machine Learning" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is the class website for Statistical Machine Learning at Macalester College." />
  <meta name="github-repo" content="bcheggeseth/253_fall_2021" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Topic 12 Evaluating Classification Models | STAT 253: Statistical Machine Learning" />
  
  <meta name="twitter:description" content="This is the class website for Statistical Machine Learning at Macalester College." />
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="logistic-regression-evaluation.html"/>
<link rel="next" href="homework-1.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="custom_styles.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href = "./">STAT 253: Statistical Machine Learning</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome!</a></li>
<li class="chapter" data-level="" data-path="schedule.html"><a href="schedule.html"><i class="fa fa-check"></i>Schedule</a></li>
<li class="chapter" data-level="" data-path="learning-goals.html"><a href="learning-goals.html"><i class="fa fa-check"></i>Learning Goals</a>
<ul>
<li class="chapter" data-level="" data-path="learning-goals.html"><a href="learning-goals.html#general-skills"><i class="fa fa-check"></i>General Skills</a></li>
<li class="chapter" data-level="" data-path="learning-goals.html"><a href="learning-goals.html#course-topics"><i class="fa fa-check"></i>Course Topics</a></li>
</ul></li>
<li class="part"><span><b>I R</b></span></li>
<li class="chapter" data-level="" data-path="r-and-rstudio-setup.html"><a href="r-and-rstudio-setup.html"><i class="fa fa-check"></i>R and RStudio Setup</a>
<ul>
<li class="chapter" data-level="" data-path="r-and-rstudio-setup.html"><a href="r-and-rstudio-setup.html#troubleshooting"><i class="fa fa-check"></i>Troubleshooting</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="r-resources.html"><a href="r-resources.html"><i class="fa fa-check"></i>R Resources</a>
<ul>
<li class="chapter" data-level="" data-path="r-resources.html"><a href="r-resources.html#tidymodels-resources"><i class="fa fa-check"></i>Tidymodels resources</a></li>
<li class="chapter" data-level="" data-path="r-resources.html"><a href="r-resources.html#tidyverse-resources"><i class="fa fa-check"></i>Tidyverse resources</a></li>
<li class="chapter" data-level="" data-path="r-resources.html"><a href="r-resources.html#visualization-resources"><i class="fa fa-check"></i>Visualization resources</a></li>
<li class="chapter" data-level="" data-path="r-resources.html"><a href="r-resources.html#general-r-resources"><i class="fa fa-check"></i>General R resources</a></li>
<li class="chapter" data-level="" data-path="r-resources.html"><a href="r-resources.html#free-online-textbooks"><i class="fa fa-check"></i>Free online textbooks</a></li>
<li class="chapter" data-level="" data-path="r-resources.html"><a href="r-resources.html#example-code"><i class="fa fa-check"></i>Example code</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="r-cheatsheet.html"><a href="r-cheatsheet.html"><i class="fa fa-check"></i>R Cheatsheet</a>
<ul>
<li class="chapter" data-level="" data-path="r-cheatsheet.html"><a href="r-cheatsheet.html#stat-155-review"><i class="fa fa-check"></i>Stat 155 Review</a>
<ul>
<li class="chapter" data-level="" data-path="r-cheatsheet.html"><a href="r-cheatsheet.html#standard-linear-regression-models"><i class="fa fa-check"></i>Standard Linear Regression Models</a></li>
<li class="chapter" data-level="" data-path="r-cheatsheet.html"><a href="r-cheatsheet.html#standard-logistic-regression-models"><i class="fa fa-check"></i>Standard Logistic Regression Models</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="r-cheatsheet.html"><a href="r-cheatsheet.html#data-structures-and-purrr"><i class="fa fa-check"></i>Data Structures and Purrr</a>
<ul>
<li class="chapter" data-level="" data-path="r-cheatsheet.html"><a href="r-cheatsheet.html#vectors-and-lists"><i class="fa fa-check"></i>Vectors and Lists</a></li>
<li class="chapter" data-level="" data-path="r-cheatsheet.html"><a href="r-cheatsheet.html#map"><i class="fa fa-check"></i>Map</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="r-cheatsheet.html"><a href="r-cheatsheet.html#tidymodels-functions"><i class="fa fa-check"></i>Tidymodels Functions</a>
<ul>
<li class="chapter" data-level="" data-path="r-cheatsheet.html"><a href="r-cheatsheet.html#model-specification"><i class="fa fa-check"></i>Model Specification</a></li>
<li class="chapter" data-level="" data-path="r-cheatsheet.html"><a href="r-cheatsheet.html#preprocessing-data"><i class="fa fa-check"></i>Preprocessing Data</a></li>
<li class="chapter" data-level="" data-path="r-cheatsheet.html"><a href="r-cheatsheet.html#data-subsets"><i class="fa fa-check"></i>Data Subsets</a></li>
<li class="chapter" data-level="" data-path="r-cheatsheet.html"><a href="r-cheatsheet.html#workflows"><i class="fa fa-check"></i>Workflows</a></li>
<li class="chapter" data-level="" data-path="r-cheatsheet.html"><a href="r-cheatsheet.html#fit-model"><i class="fa fa-check"></i>Fit Model</a></li>
<li class="chapter" data-level="" data-path="r-cheatsheet.html"><a href="r-cheatsheet.html#evaluate-model-metrics"><i class="fa fa-check"></i>Evaluate Model: Metrics</a></li>
<li class="chapter" data-level="" data-path="r-cheatsheet.html"><a href="r-cheatsheet.html#tune-model-hyperparameters"><i class="fa fa-check"></i>Tune Model: Hyperparameters</a></li>
<li class="chapter" data-level="" data-path="r-cheatsheet.html"><a href="r-cheatsheet.html#use-final-model-predictions"><i class="fa fa-check"></i>Use Final Model: Predictions</a></li>
<li class="chapter" data-level="" data-path="r-cheatsheet.html"><a href="r-cheatsheet.html#comparing-models-workflow-sets"><i class="fa fa-check"></i>Comparing Models: Workflow Sets</a></li>
<li class="chapter" data-level="" data-path="r-cheatsheet.html"><a href="r-cheatsheet.html#extraction"><i class="fa fa-check"></i>Extraction</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="r-cheatsheet.html"><a href="r-cheatsheet.html#real-data-example-regression"><i class="fa fa-check"></i>Real Data Example: Regression</a>
<ul>
<li class="chapter" data-level="" data-path="r-cheatsheet.html"><a href="r-cheatsheet.html#linear-regression"><i class="fa fa-check"></i>Linear Regression</a></li>
<li class="chapter" data-level="" data-path="r-cheatsheet.html"><a href="r-cheatsheet.html#regularized-regression"><i class="fa fa-check"></i>Regularized Regression</a></li>
<li class="chapter" data-level="" data-path="r-cheatsheet.html"><a href="r-cheatsheet.html#nearest-neighbors"><i class="fa fa-check"></i>Nearest Neighbors</a></li>
<li class="chapter" data-level="" data-path="r-cheatsheet.html"><a href="r-cheatsheet.html#splines-and-local-regression"><i class="fa fa-check"></i>Splines and Local Regression</a></li>
<li class="chapter" data-level="" data-path="r-cheatsheet.html"><a href="r-cheatsheet.html#gam"><i class="fa fa-check"></i>GAM</a></li>
<li class="chapter" data-level="" data-path="r-cheatsheet.html"><a href="r-cheatsheet.html#regression-trees"><i class="fa fa-check"></i>Regression Trees</a></li>
<li class="chapter" data-level="" data-path="r-cheatsheet.html"><a href="r-cheatsheet.html#comparison-of-methods"><i class="fa fa-check"></i>Comparison of Methods</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="r-cheatsheet.html"><a href="r-cheatsheet.html#real-data-example-classification"><i class="fa fa-check"></i>Real Data Example: Classification</a>
<ul>
<li class="chapter" data-level="" data-path="r-cheatsheet.html"><a href="r-cheatsheet.html#logistic-regression"><i class="fa fa-check"></i>Logistic Regression</a></li>
<li class="chapter" data-level="" data-path="r-cheatsheet.html"><a href="r-cheatsheet.html#regularized-logistic-regression"><i class="fa fa-check"></i>Regularized Logistic Regression</a></li>
<li class="chapter" data-level="" data-path="r-cheatsheet.html"><a href="r-cheatsheet.html#classification-trees"><i class="fa fa-check"></i>Classification Trees</a></li>
<li class="chapter" data-level="" data-path="r-cheatsheet.html"><a href="r-cheatsheet.html#random-forest"><i class="fa fa-check"></i>Random Forest</a></li>
<li class="chapter" data-level="" data-path="r-cheatsheet.html"><a href="r-cheatsheet.html#comparison-of-methods-1"><i class="fa fa-check"></i>Comparison of Methods</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="r-cheatsheet.html"><a href="r-cheatsheet.html#visualizing-fit-models"><i class="fa fa-check"></i>Visualizing Fit Models</a>
<ul>
<li class="chapter" data-level="" data-path="r-cheatsheet.html"><a href="r-cheatsheet.html#coefficients"><i class="fa fa-check"></i>Coefficients</a></li>
<li class="chapter" data-level="" data-path="r-cheatsheet.html"><a href="r-cheatsheet.html#effects"><i class="fa fa-check"></i>Effects</a></li>
<li class="chapter" data-level="" data-path="r-cheatsheet.html"><a href="r-cheatsheet.html#residuals"><i class="fa fa-check"></i>Residuals</a></li>
<li class="chapter" data-level="" data-path="r-cheatsheet.html"><a href="r-cheatsheet.html#predictions"><i class="fa fa-check"></i>Predictions</a></li>
<li class="chapter" data-level="" data-path="r-cheatsheet.html"><a href="r-cheatsheet.html#variable-importance"><i class="fa fa-check"></i>Variable Importance</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Introductions</b></span></li>
<li class="chapter" data-level="1" data-path="introductions.html"><a href="introductions.html"><i class="fa fa-check"></i><b>1</b> Introductions</a>
<ul>
<li class="chapter" data-level="" data-path="introductions.html"><a href="introductions.html#envisioning-a-community-of-learners"><i class="fa fa-check"></i>Envisioning a Community of Learners</a></li>
<li class="chapter" data-level="" data-path="introductions.html"><a href="introductions.html#explorations"><i class="fa fa-check"></i>Explorations</a></li>
</ul></li>
<li class="part"><span><b>III Regression: Evaluation</b></span></li>
<li class="chapter" data-level="2" data-path="evaluating-regression-models.html"><a href="evaluating-regression-models.html"><i class="fa fa-check"></i><b>2</b> Evaluating Regression Models</a>
<ul>
<li class="chapter" data-level="" data-path="evaluating-regression-models.html"><a href="evaluating-regression-models.html#learning-goals-1"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="evaluating-regression-models.html"><a href="evaluating-regression-models.html#exercises"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="evaluating-regression-models.html"><a href="evaluating-regression-models.html#context"><i class="fa fa-check"></i>Context</a></li>
<li class="chapter" data-level="" data-path="evaluating-regression-models.html"><a href="evaluating-regression-models.html#class-investigations"><i class="fa fa-check"></i>Class investigations</a></li>
<li class="chapter" data-level="" data-path="evaluating-regression-models.html"><a href="evaluating-regression-models.html#exercise-1"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="" data-path="evaluating-regression-models.html"><a href="evaluating-regression-models.html#exercise-2"><i class="fa fa-check"></i>Exercise 2</a></li>
<li class="chapter" data-level="" data-path="evaluating-regression-models.html"><a href="evaluating-regression-models.html#exercise-3"><i class="fa fa-check"></i>Exercise 3</a></li>
<li class="chapter" data-level="" data-path="evaluating-regression-models.html"><a href="evaluating-regression-models.html#exercise-4"><i class="fa fa-check"></i>Exercise 4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="overfitting.html"><a href="overfitting.html"><i class="fa fa-check"></i><b>3</b> Overfitting</a>
<ul>
<li class="chapter" data-level="" data-path="overfitting.html"><a href="overfitting.html#learning-goals-2"><i class="fa fa-check"></i>Learning Goals</a></li>
<li><a href="overfitting.html#the-tidymodels-package">The <code>tidymodels</code> package</a></li>
<li class="chapter" data-level="" data-path="overfitting.html"><a href="overfitting.html#exercises-1"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="overfitting.html"><a href="overfitting.html#context-1"><i class="fa fa-check"></i>Context</a></li>
<li class="chapter" data-level="" data-path="overfitting.html"><a href="overfitting.html#exercise-1-5-models"><i class="fa fa-check"></i>Exercise 1: 5 models</a></li>
<li class="chapter" data-level="" data-path="overfitting.html"><a href="overfitting.html#exercise-2-visualizing-predictions"><i class="fa fa-check"></i>Exercise 2: Visualizing Predictions</a></li>
<li class="chapter" data-level="" data-path="overfitting.html"><a href="overfitting.html#exercise-3-evaluating-on-test-data"><i class="fa fa-check"></i>Exercise 3: Evaluating on Test Data</a></li>
<li class="chapter" data-level="" data-path="overfitting.html"><a href="overfitting.html#exercise-4-overfitting"><i class="fa fa-check"></i>Exercise 4: Overfitting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="cross-validation.html"><a href="cross-validation.html"><i class="fa fa-check"></i><b>4</b> Cross-validation</a>
<ul>
<li class="chapter" data-level="" data-path="cross-validation.html"><a href="cross-validation.html#learning-goals-3"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="cross-validation.html"><a href="cross-validation.html#writing-good-sentences"><i class="fa fa-check"></i>Writing Good Sentences</a>
<ul>
<li class="chapter" data-level="" data-path="cross-validation.html"><a href="cross-validation.html#instructions"><i class="fa fa-check"></i>Instructions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="cross-validation.html"><a href="cross-validation.html#exercises-2"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="cross-validation.html"><a href="cross-validation.html#context-2"><i class="fa fa-check"></i>Context</a></li>
<li class="chapter" data-level="" data-path="cross-validation.html"><a href="cross-validation.html#exercise-1-cross-validation-in-concept"><i class="fa fa-check"></i>Exercise 1: Cross-validation in Concept</a></li>
<li><a href="cross-validation.html#exercise-2-cross-validation-with-tidymodels">Exercise 2: Cross-validation with <code>tidymodels</code></a></li>
<li class="chapter" data-level="" data-path="cross-validation.html"><a href="cross-validation.html#exercise-3-looking-at-the-evaluation-metrics"><i class="fa fa-check"></i>Exercise 3: Looking at the evaluation metrics</a></li>
<li class="chapter" data-level="" data-path="cross-validation.html"><a href="cross-validation.html#exercise-4-practical-issues-choosing-the-number-of-folds"><i class="fa fa-check"></i>Exercise 4: Practical issues: choosing the number of folds</a></li>
<li class="chapter" data-level="" data-path="cross-validation.html"><a href="cross-validation.html#digging-deeper"><i class="fa fa-check"></i>Digging deeper</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Regression: Building Models</b></span></li>
<li class="chapter" data-level="5" data-path="variable-subset-selection.html"><a href="variable-subset-selection.html"><i class="fa fa-check"></i><b>5</b> Variable Subset Selection</a>
<ul>
<li class="chapter" data-level="" data-path="variable-subset-selection.html"><a href="variable-subset-selection.html#learning-goals-4"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="variable-subset-selection.html"><a href="variable-subset-selection.html#writing-good-sentences-part-2"><i class="fa fa-check"></i>Writing Good Sentences Part 2</a></li>
<li class="chapter" data-level="" data-path="variable-subset-selection.html"><a href="variable-subset-selection.html#exercises-3"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="variable-subset-selection.html"><a href="variable-subset-selection.html#exercise-1-backward-stepwise-selection-by-hand"><i class="fa fa-check"></i>Exercise 1: Backward stepwise selection: by hand</a></li>
<li class="chapter" data-level="" data-path="variable-subset-selection.html"><a href="variable-subset-selection.html#exercise-2-interpreting-the-results"><i class="fa fa-check"></i>Exercise 2: Interpreting the results</a></li>
<li class="chapter" data-level="" data-path="variable-subset-selection.html"><a href="variable-subset-selection.html#exercise-3-planning-forward-selection-using-cv"><i class="fa fa-check"></i>Exercise 3: Planning forward selection using CV</a></li>
<li class="chapter" data-level="" data-path="variable-subset-selection.html"><a href="variable-subset-selection.html#exercise-4-approaches-to-variable-subset-selection"><i class="fa fa-check"></i>Exercise 4: Approaches to variable subset selection</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="lasso-shrinkageregularization.html"><a href="lasso-shrinkageregularization.html"><i class="fa fa-check"></i><b>6</b> LASSO: Shrinkage/Regularization</a>
<ul>
<li class="chapter" data-level="" data-path="lasso-shrinkageregularization.html"><a href="lasso-shrinkageregularization.html#learning-goals-5"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="lasso-shrinkageregularization.html"><a href="lasso-shrinkageregularization.html#lasso-in-theory"><i class="fa fa-check"></i>LASSO in Theory</a></li>
<li><a href="lasso-shrinkageregularization.html#lasso-models-in-tidymodels">LASSO models in <code>tidymodels</code></a></li>
<li class="chapter" data-level="" data-path="lasso-shrinkageregularization.html"><a href="lasso-shrinkageregularization.html#exercises-4"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="lasso-shrinkageregularization.html"><a href="lasso-shrinkageregularization.html#exercise-1-a-least-squares-model"><i class="fa fa-check"></i>Exercise 1: A least squares model</a></li>
<li><a href="lasso-shrinkageregularization.html#exercise-2-fitting-a-lasso-model-in-tidymodels">Exercise 2: Fitting a LASSO model in <code>tidymodels</code></a></li>
<li class="chapter" data-level="" data-path="lasso-shrinkageregularization.html"><a href="lasso-shrinkageregularization.html#exercise-3-examining-output-plot-of-coefficient-paths"><i class="fa fa-check"></i>Exercise 3: Examining output: plot of coefficient paths</a></li>
<li class="chapter" data-level="" data-path="lasso-shrinkageregularization.html"><a href="lasso-shrinkageregularization.html#exercise-4-examining-and-evaluating-the-best-lasso-model"><i class="fa fa-check"></i>Exercise 4: Examining and evaluating the best LASSO model</a></li>
<li class="chapter" data-level="" data-path="lasso-shrinkageregularization.html"><a href="lasso-shrinkageregularization.html#digging-deeper-1"><i class="fa fa-check"></i>Digging deeper</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>V Regression: Building Flexible Models</b></span></li>
<li class="chapter" data-level="7" data-path="knn-regression-and-the-bias-variance-tradeoff.html"><a href="knn-regression-and-the-bias-variance-tradeoff.html"><i class="fa fa-check"></i><b>7</b> KNN Regression and the Bias-Variance Tradeoff</a>
<ul>
<li class="chapter" data-level="" data-path="knn-regression-and-the-bias-variance-tradeoff.html"><a href="knn-regression-and-the-bias-variance-tradeoff.html#learning-goals-6"><i class="fa fa-check"></i>Learning Goals</a></li>
<li><a href="knn-regression-and-the-bias-variance-tradeoff.html#knn-models-in-tidymodels">KNN models in <code>tidymodels</code></a></li>
<li class="chapter" data-level="" data-path="knn-regression-and-the-bias-variance-tradeoff.html"><a href="knn-regression-and-the-bias-variance-tradeoff.html#exercises-5"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="knn-regression-and-the-bias-variance-tradeoff.html"><a href="knn-regression-and-the-bias-variance-tradeoff.html#hello-how-are-things"><i class="fa fa-check"></i>Hello, how are things?</a></li>
<li class="chapter" data-level="" data-path="knn-regression-and-the-bias-variance-tradeoff.html"><a href="knn-regression-and-the-bias-variance-tradeoff.html#exercise-1-bias-variance-tradeoff-warmup"><i class="fa fa-check"></i>Exercise 1: Bias-variance tradeoff warmup</a></li>
<li class="chapter" data-level="" data-path="knn-regression-and-the-bias-variance-tradeoff.html"><a href="knn-regression-and-the-bias-variance-tradeoff.html#exercise-2-impact-of-variable-scale-and-distance-measure"><i class="fa fa-check"></i>Exercise 2: Impact of variable scale and distance measure</a></li>
<li><a href="knn-regression-and-the-bias-variance-tradeoff.html#exercise-3-implementing-knn-in-tidymodels">Exercise 3: Implementing KNN in <code>tidymodels</code></a></li>
<li class="chapter" data-level="" data-path="knn-regression-and-the-bias-variance-tradeoff.html"><a href="knn-regression-and-the-bias-variance-tradeoff.html#exercise-4-inspecting-the-results"><i class="fa fa-check"></i>Exercise 4: Inspecting the results</a></li>
<li class="chapter" data-level="" data-path="knn-regression-and-the-bias-variance-tradeoff.html"><a href="knn-regression-and-the-bias-variance-tradeoff.html#exercise-5-curse-of-dimensionality"><i class="fa fa-check"></i>Exercise 5: Curse of dimensionality</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="catch-up-day.html"><a href="catch-up-day.html"><i class="fa fa-check"></i><b>8</b> Catch up Day</a>
<ul>
<li class="chapter" data-level="" data-path="catch-up-day.html"><a href="catch-up-day.html#learning-goals-7"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="catch-up-day.html"><a href="catch-up-day.html#content-conversation-1-prompts"><i class="fa fa-check"></i>Content Conversation 1 Prompts</a></li>
<li class="chapter" data-level="" data-path="catch-up-day.html"><a href="catch-up-day.html#peer-review"><i class="fa fa-check"></i>Peer Review</a></li>
<li class="chapter" data-level="" data-path="catch-up-day.html"><a href="catch-up-day.html#project-work"><i class="fa fa-check"></i>Project Work</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="splines.html"><a href="splines.html"><i class="fa fa-check"></i><b>9</b> Splines</a>
<ul>
<li class="chapter" data-level="" data-path="splines.html"><a href="splines.html#learning-goals-8"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="splines.html"><a href="splines.html#splines-1"><i class="fa fa-check"></i>Splines</a></li>
<li><a href="splines.html#splines-in-tidymodels">Splines in <code>tidymodels</code></a></li>
<li class="chapter" data-level="" data-path="splines.html"><a href="splines.html#exercises-6"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="splines.html"><a href="splines.html#exercise-1-evaluating-a-fully-linear-model"><i class="fa fa-check"></i>Exercise 1: Evaluating a fully linear model</a></li>
<li class="chapter" data-level="" data-path="splines.html"><a href="splines.html#exercise-2-evaluating-a-spline-model"><i class="fa fa-check"></i>Exercise 2: Evaluating a spline model</a></li>
<li class="chapter" data-level="" data-path="splines.html"><a href="splines.html#extra-variable-scaling"><i class="fa fa-check"></i>Extra! Variable scaling</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="local-regression-gams.html"><a href="local-regression-gams.html"><i class="fa fa-check"></i><b>10</b> Local Regression &amp; GAMs</a>
<ul>
<li class="chapter" data-level="" data-path="local-regression-gams.html"><a href="local-regression-gams.html#learning-goals-9"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="local-regression-gams.html"><a href="local-regression-gams.html#gams"><i class="fa fa-check"></i>GAMs</a></li>
<li class="chapter" data-level="" data-path="local-regression-gams.html"><a href="local-regression-gams.html#gams---options-for-fitting"><i class="fa fa-check"></i>GAMs - Options for Fitting</a>
<ul>
<li class="chapter" data-level="" data-path="local-regression-gams.html"><a href="local-regression-gams.html#gams-b-splines-ols"><i class="fa fa-check"></i>GAMs (B-splines + OLS)</a></li>
<li class="chapter" data-level="" data-path="local-regression-gams.html"><a href="local-regression-gams.html#gams-loess"><i class="fa fa-check"></i>GAMs (LOESS)</a></li>
<li><a href="local-regression-gams.html#gams-smoothing-splines-in-tidymodels">GAMs (smoothing splines) in <code>tidymodels</code></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="local-regression-gams.html"><a href="local-regression-gams.html#exercises-7"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="local-regression-gams.html"><a href="local-regression-gams.html#exercise-1-conceptual-warmup"><i class="fa fa-check"></i>Exercise 1: Conceptual warmup</a></li>
<li class="chapter" data-level="" data-path="local-regression-gams.html"><a href="local-regression-gams.html#exercise-2-using-loess"><i class="fa fa-check"></i>Exercise 2: Using LOESS</a></li>
<li><a href="local-regression-gams.html#exercise-3-building-a-gam-in-tidymodels">Exercise 3: Building a GAM in <code>tidymodels</code></a></li>
<li class="chapter" data-level="" data-path="local-regression-gams.html"><a href="local-regression-gams.html#exercise-4-adjusting-the-best-gam"><i class="fa fa-check"></i>Exercise 4: Adjusting the “best” GAM</a></li>
<li class="chapter" data-level="" data-path="local-regression-gams.html"><a href="local-regression-gams.html#exercise-5-gam-with-recipes"><i class="fa fa-check"></i>Exercise 5: GAM with recipes</a></li>
<li class="chapter" data-level="" data-path="local-regression-gams.html"><a href="local-regression-gams.html#exercise-6-comparison-of-methods"><i class="fa fa-check"></i>Exercise 6: Comparison of methods</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>VI Classification</b></span></li>
<li class="chapter" data-level="11" data-path="logistic-regression-evaluation.html"><a href="logistic-regression-evaluation.html"><i class="fa fa-check"></i><b>11</b> Logistic Regression &amp; Evaluation</a>
<ul>
<li class="chapter" data-level="" data-path="logistic-regression-evaluation.html"><a href="logistic-regression-evaluation.html#learning-goals-10"><i class="fa fa-check"></i>Learning Goals</a></li>
<li><a href="logistic-regression-evaluation.html#logistic-regression-in-tidymodels">Logistic regression in <code>tidymodels</code></a></li>
<li class="chapter" data-level="" data-path="logistic-regression-evaluation.html"><a href="logistic-regression-evaluation.html#exercises-8"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="logistic-regression-evaluation.html"><a href="logistic-regression-evaluation.html#context-3"><i class="fa fa-check"></i>Context</a></li>
<li class="chapter" data-level="" data-path="logistic-regression-evaluation.html"><a href="logistic-regression-evaluation.html#exercise-1-visualization-warmup"><i class="fa fa-check"></i>Exercise 1: Visualization warmup</a></li>
<li><a href="logistic-regression-evaluation.html#exercise-2-implementing-logistic-regression-in-tidymodels">Exercise 2: Implementing logistic regression in <code>tidymodels</code></a></li>
<li class="chapter" data-level="" data-path="logistic-regression-evaluation.html"><a href="logistic-regression-evaluation.html#exercise-3-interpreting-the-model"><i class="fa fa-check"></i>Exercise 3: Interpreting the model</a></li>
<li class="chapter" data-level="" data-path="logistic-regression-evaluation.html"><a href="logistic-regression-evaluation.html#exercise-4-making-predictions"><i class="fa fa-check"></i>Exercise 4: Making predictions</a></li>
<li class="chapter" data-level="" data-path="logistic-regression-evaluation.html"><a href="logistic-regression-evaluation.html#exercise-5-evaluate-the-model"><i class="fa fa-check"></i>Exercise 5: Evaluate the model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="evaluating-classification-models.html"><a href="evaluating-classification-models.html"><i class="fa fa-check"></i><b>12</b> Evaluating Classification Models</a>
<ul>
<li class="chapter" data-level="" data-path="evaluating-classification-models.html"><a href="evaluating-classification-models.html#learning-goals-11"><i class="fa fa-check"></i>Learning Goals</a></li>
<li><a href="evaluating-classification-models.html#lasso-for-logistic-regression-in-tidymodels">LASSO for logistic regression in <code>tidymodels</code></a></li>
<li class="chapter" data-level="" data-path="evaluating-classification-models.html"><a href="evaluating-classification-models.html#exercises-9"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="evaluating-classification-models.html"><a href="evaluating-classification-models.html#context-4"><i class="fa fa-check"></i>Context</a></li>
<li class="chapter" data-level="" data-path="evaluating-classification-models.html"><a href="evaluating-classification-models.html#exercise-1-conceptual-warmup-1"><i class="fa fa-check"></i>Exercise 1: Conceptual warmup</a></li>
<li><a href="evaluating-classification-models.html#exercise-2-implementing-lasso-logistic-regression-in-tidymodels">Exercise 2: Implementing LASSO logistic regression in <code>tidymodels</code></a></li>
<li class="chapter" data-level="" data-path="evaluating-classification-models.html"><a href="evaluating-classification-models.html#exercise-3-inspecting-the-model"><i class="fa fa-check"></i>Exercise 3: Inspecting the model</a></li>
<li class="chapter" data-level="" data-path="evaluating-classification-models.html"><a href="evaluating-classification-models.html#exercise-4-interpreting-evaluation-metrics"><i class="fa fa-check"></i>Exercise 4: Interpreting evaluation metrics</a></li>
<li class="chapter" data-level="" data-path="evaluating-classification-models.html"><a href="evaluating-classification-models.html#exercise-5-using-the-final-model-choosing-a-threshold"><i class="fa fa-check"></i>Exercise 5: Using the final model (choosing a threshold)</a></li>
<li class="chapter" data-level="" data-path="evaluating-classification-models.html"><a href="evaluating-classification-models.html#exercise-6-algorithmic-understanding-for-evaluation-metrics"><i class="fa fa-check"></i>Exercise 6: Algorithmic understanding for evaluation metrics</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>VII Homework</b></span></li>
<li class="chapter" data-level="" data-path="homework-1.html"><a href="homework-1.html"><i class="fa fa-check"></i>Homework 1</a>
<ul>
<li class="chapter" data-level="" data-path="homework-1.html"><a href="homework-1.html#project-work-1"><i class="fa fa-check"></i>Project Work</a></li>
<li class="chapter" data-level="" data-path="homework-1.html"><a href="homework-1.html#portfolio-work"><i class="fa fa-check"></i>Portfolio Work</a></li>
<li class="chapter" data-level="" data-path="homework-1.html"><a href="homework-1.html#reflection"><i class="fa fa-check"></i>Reflection</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="homework-2.html"><a href="homework-2.html"><i class="fa fa-check"></i>Homework 2</a>
<ul>
<li class="chapter" data-level="" data-path="homework-2.html"><a href="homework-2.html#project-work-2"><i class="fa fa-check"></i>Project Work</a>
<ul>
<li class="chapter" data-level="" data-path="homework-2.html"><a href="homework-2.html#instructions-1"><i class="fa fa-check"></i>Instructions</a></li>
<li class="chapter" data-level="" data-path="homework-2.html"><a href="homework-2.html#required-analyses"><i class="fa fa-check"></i>Required Analyses</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="homework-2.html"><a href="homework-2.html#portfolio-work-1"><i class="fa fa-check"></i>Portfolio Work</a></li>
<li class="chapter" data-level="" data-path="homework-2.html"><a href="homework-2.html#reflection-1"><i class="fa fa-check"></i>Reflection</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="homework-3.html"><a href="homework-3.html"><i class="fa fa-check"></i>Homework 3</a>
<ul>
<li class="chapter" data-level="" data-path="homework-3.html"><a href="homework-3.html#project-work-3"><i class="fa fa-check"></i>Project Work</a></li>
<li class="chapter" data-level="" data-path="homework-3.html"><a href="homework-3.html#portfolio-work-2"><i class="fa fa-check"></i>Portfolio Work</a></li>
<li class="chapter" data-level="" data-path="homework-3.html"><a href="homework-3.html#reflection-2"><i class="fa fa-check"></i>Reflection</a></li>
</ul></li>
<li class="part"><span><b>VIII Project</b></span></li>
<li class="chapter" data-level="" data-path="final-project.html"><a href="final-project.html"><i class="fa fa-check"></i>Final Project</a>
<ul>
<li class="chapter" data-level="" data-path="final-project.html"><a href="final-project.html#requirements"><i class="fa fa-check"></i>Requirements</a></li>
<li class="chapter" data-level="" data-path="final-project.html"><a href="final-project.html#expectations"><i class="fa fa-check"></i>Expectations</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">STAT 253: Statistical Machine Learning</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="evaluating-classification-models" class="section level1" number="12">
<h1><span class="header-section-number">Topic 12</span> Evaluating Classification Models</h1>
<div id="learning-goals-11" class="section level2 unnumbered">
<h2>Learning Goals</h2>
<ul>
<li>Describe how you can use LASSO for logistic regression model (differences from and similarities to linear models)</li>
<li>Calculate (by hand from confusion matrices) and contextually interpret overall accuracy, sensitivity, and specificity</li>
<li>Construct and interpret plots of predicted probabilities across classes</li>
<li>Explain how a ROC curve is constructed and the rationale behind AUC as an evaluation metric</li>
<li>Appropriately use and interpret the no-information rate to evaluate accuracy metrics</li>
</ul>
<p><br></p>
<p>Slides from today are available <a href="https://docs.google.com/presentation/d/1t8MyaLlQ_4tXL0pXA_2JyuCl7V72pYkgbtKVnDt2It0/edit?usp=sharing">here</a>.</p>
<p><br><br><br></p>
</div>
<div id="lasso-for-logistic-regression-in-tidymodels" class="section level2 unnumbered">
<h2>LASSO for logistic regression in <code>tidymodels</code></h2>
<p>To build LASSO models for logistic regression in <code>caret</code>, first load the package and set the seed for the random number generator to ensure reproducible results:</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="evaluating-classification-models.html#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb169-2"><a href="evaluating-classification-models.html#cb169-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb169-3"><a href="evaluating-classification-models.html#cb169-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb169-4"><a href="evaluating-classification-models.html#cb169-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(probably) <span class="co">#install.packages(&#39;probably&#39;)</span></span>
<span id="cb169-5"><a href="evaluating-classification-models.html#cb169-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tidymodels_prefer</span>()</span>
<span id="cb169-6"><a href="evaluating-classification-models.html#cb169-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-7"><a href="evaluating-classification-models.html#cb169-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(___) <span class="co"># Pick your favorite number to fill in the parentheses</span></span></code></pre></div>
<p>If we would like to use estimates of AUC of the ROC curve to choose our final model, we can adapt the following:</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="evaluating-classification-models.html#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make sure you set reference level (the outcome you are NOT interested in)</span></span>
<span id="cb170-2"><a href="evaluating-classification-models.html#cb170-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb170-3"><a href="evaluating-classification-models.html#cb170-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">outcome =</span> <span class="fu">relevel</span>(outcome, <span class="at">ref=</span><span class="st">&#39;failure&#39;</span>)) <span class="co">#set reference level</span></span>
<span id="cb170-4"><a href="evaluating-classification-models.html#cb170-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-5"><a href="evaluating-classification-models.html#cb170-5" aria-hidden="true" tabindex="-1"></a>data_cv10 <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(data, <span class="at">v =</span> <span class="dv">10</span>)</span>
<span id="cb170-6"><a href="evaluating-classification-models.html#cb170-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-7"><a href="evaluating-classification-models.html#cb170-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Logistic LASSO Regression Model Spec</span></span>
<span id="cb170-8"><a href="evaluating-classification-models.html#cb170-8" aria-hidden="true" tabindex="-1"></a>logistic_lasso_spec_tune <span class="ot">&lt;-</span> <span class="fu">logistic_reg</span>() <span class="sc">%&gt;%</span></span>
<span id="cb170-9"><a href="evaluating-classification-models.html#cb170-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_engine</span>(<span class="st">&#39;glmnet&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb170-10"><a href="evaluating-classification-models.html#cb170-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_args</span>(<span class="at">mixture =</span> <span class="dv">1</span>, <span class="at">penalty =</span> <span class="fu">tune</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb170-11"><a href="evaluating-classification-models.html#cb170-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_mode</span>(<span class="st">&#39;classification&#39;</span>)</span>
<span id="cb170-12"><a href="evaluating-classification-models.html#cb170-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb170-13"><a href="evaluating-classification-models.html#cb170-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Recipe</span></span>
<span id="cb170-14"><a href="evaluating-classification-models.html#cb170-14" aria-hidden="true" tabindex="-1"></a>logistic_rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(outcome <span class="sc">~</span> ., <span class="at">data =</span> data) <span class="sc">%&gt;%</span></span>
<span id="cb170-15"><a href="evaluating-classification-models.html#cb170-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb170-16"><a href="evaluating-classification-models.html#cb170-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>())</span>
<span id="cb170-17"><a href="evaluating-classification-models.html#cb170-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-18"><a href="evaluating-classification-models.html#cb170-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Workflow (Recipe + Model)</span></span>
<span id="cb170-19"><a href="evaluating-classification-models.html#cb170-19" aria-hidden="true" tabindex="-1"></a>log_lasso_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb170-20"><a href="evaluating-classification-models.html#cb170-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_recipe</span>(logistic_rec) <span class="sc">%&gt;%</span></span>
<span id="cb170-21"><a href="evaluating-classification-models.html#cb170-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_model</span>(logistic_lasso_spec_tune)     </span>
<span id="cb170-22"><a href="evaluating-classification-models.html#cb170-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-23"><a href="evaluating-classification-models.html#cb170-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Tune Model (trying a variety of values of Lambda penalty)</span></span>
<span id="cb170-24"><a href="evaluating-classification-models.html#cb170-24" aria-hidden="true" tabindex="-1"></a>penalty_grid <span class="ot">&lt;-</span> <span class="fu">grid_regular</span>(</span>
<span id="cb170-25"><a href="evaluating-classification-models.html#cb170-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">penalty</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">1</span>)), <span class="co">#log10 transformed </span></span>
<span id="cb170-26"><a href="evaluating-classification-models.html#cb170-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="dv">30</span>)</span>
<span id="cb170-27"><a href="evaluating-classification-models.html#cb170-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-28"><a href="evaluating-classification-models.html#cb170-28" aria-hidden="true" tabindex="-1"></a>tune_output <span class="ot">&lt;-</span> <span class="fu">tune_grid</span>( </span>
<span id="cb170-29"><a href="evaluating-classification-models.html#cb170-29" aria-hidden="true" tabindex="-1"></a>  log_lasso_wf, <span class="co"># workflow</span></span>
<span id="cb170-30"><a href="evaluating-classification-models.html#cb170-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">resamples =</span> data_cv10, <span class="co"># cv folds</span></span>
<span id="cb170-31"><a href="evaluating-classification-models.html#cb170-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">metrics =</span> <span class="fu">metric_set</span>(roc_auc),</span>
<span id="cb170-32"><a href="evaluating-classification-models.html#cb170-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">control_resamples</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>, <span class="at">event_level =</span> <span class="st">&#39;second&#39;</span>),</span>
<span id="cb170-33"><a href="evaluating-classification-models.html#cb170-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">grid =</span> penalty_grid <span class="co"># penalty grid defined above</span></span>
<span id="cb170-34"><a href="evaluating-classification-models.html#cb170-34" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb170-35"><a href="evaluating-classification-models.html#cb170-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-36"><a href="evaluating-classification-models.html#cb170-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize Model Evaluation Metrics from Tuning</span></span>
<span id="cb170-37"><a href="evaluating-classification-models.html#cb170-37" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(tune_output) <span class="sc">+</span> <span class="fu">theme_classic</span>()</span>
<span id="cb170-38"><a href="evaluating-classification-models.html#cb170-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-39"><a href="evaluating-classification-models.html#cb170-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Select Penalty</span></span>
<span id="cb170-40"><a href="evaluating-classification-models.html#cb170-40" aria-hidden="true" tabindex="-1"></a>best_se_penalty <span class="ot">&lt;-</span> <span class="fu">select_by_one_std_err</span>(tune_output, <span class="at">metric =</span> <span class="st">&#39;roc_auc&#39;</span>, <span class="fu">desc</span>(penalty)) <span class="co"># choose penalty value based on the largest penalty within 1 se of the lowest CV roc_auc</span></span>
<span id="cb170-41"><a href="evaluating-classification-models.html#cb170-41" aria-hidden="true" tabindex="-1"></a>best_se_penalty</span>
<span id="cb170-42"><a href="evaluating-classification-models.html#cb170-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-43"><a href="evaluating-classification-models.html#cb170-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit Final Model</span></span>
<span id="cb170-44"><a href="evaluating-classification-models.html#cb170-44" aria-hidden="true" tabindex="-1"></a>final_fit_se <span class="ot">&lt;-</span> <span class="fu">finalize_workflow</span>(log_lasso_wf, best_se_penalty) <span class="sc">%&gt;%</span> <span class="co"># incorporates penalty value to workflow </span></span>
<span id="cb170-45"><a href="evaluating-classification-models.html#cb170-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fit</span>(<span class="at">data =</span> data)</span>
<span id="cb170-46"><a href="evaluating-classification-models.html#cb170-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-47"><a href="evaluating-classification-models.html#cb170-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-48"><a href="evaluating-classification-models.html#cb170-48" aria-hidden="true" tabindex="-1"></a>final_fit_se <span class="sc">%&gt;%</span> <span class="fu">tidy</span>()</span></code></pre></div>
<p><br><br><br></p>
</div>
<div id="exercises-9" class="section level2 unnumbered">
<h2>Exercises</h2>
<p><strong>You can download a template RMarkdown file to start from <a href="template_rmds/12-lasso-logistic.Rmd">here</a>.</strong></p>
<div id="context-4" class="section level3 unnumbered">
<h3>Context</h3>
<p>Before proceeding, install the <code>pROC</code> package (utilities for evaluating classification models with ROC curves) by entering <code>install.packages("pROC")</code> in the Console.</p>
<p>We’ll continue working with the <a href="https://archive.ics.uci.edu/ml/datasets/Spambase">spam dataset</a> from last time.</p>
<ul>
<li><code>spam</code>: Either <code>spam</code> or <code>not spam</code> (outcome)</li>
<li><code>word_freq_WORD</code>: percentage of words in the e-mail that match <code>WORD</code> (0-100)</li>
<li><code>char_freq_CHAR</code>: percentage of characters in the e-mail that match <code>CHAR</code> (e.g., exclamation points, dollar signs)</li>
<li><code>capital_run_length_average</code>: average length of uninterrupted sequences of capital letters</li>
<li><code>capital_run_length_longest</code>: length of longest uninterrupted sequence of capital letters</li>
<li><code>capital_run_length_total</code>: sum of length of uninterrupted sequences of capital letters</li>
</ul>
<p>Our goal will be to use email features to predict whether or not an email is spam - essentially, to build a spam filter!</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="evaluating-classification-models.html#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb171-2"><a href="evaluating-classification-models.html#cb171-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb171-3"><a href="evaluating-classification-models.html#cb171-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb171-4"><a href="evaluating-classification-models.html#cb171-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb171-5"><a href="evaluating-classification-models.html#cb171-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(probably) <span class="co">#install.packages(&#39;probably&#39;)</span></span>
<span id="cb171-6"><a href="evaluating-classification-models.html#cb171-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tidymodels_prefer</span>()</span>
<span id="cb171-7"><a href="evaluating-classification-models.html#cb171-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-8"><a href="evaluating-classification-models.html#cb171-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-9"><a href="evaluating-classification-models.html#cb171-9" aria-hidden="true" tabindex="-1"></a>spam <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;https://www.dropbox.com/s/leurr6a30f4l32a/spambase.csv?dl=1&quot;</span>)</span>
<span id="cb171-10"><a href="evaluating-classification-models.html#cb171-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-11"><a href="evaluating-classification-models.html#cb171-11" aria-hidden="true" tabindex="-1"></a><span class="co"># A little data cleaning to remove the space in &quot;not spam&quot;</span></span>
<span id="cb171-12"><a href="evaluating-classification-models.html#cb171-12" aria-hidden="true" tabindex="-1"></a>spam <span class="ot">&lt;-</span> spam <span class="sc">%&gt;%</span></span>
<span id="cb171-13"><a href="evaluating-classification-models.html#cb171-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">spam =</span> <span class="fu">ifelse</span>(spam<span class="sc">==</span><span class="st">&quot;spam&quot;</span>, <span class="st">&quot;spam&quot;</span>, <span class="st">&quot;not_spam&quot;</span>))</span></code></pre></div>
</div>
<div id="exercise-1-conceptual-warmup-1" class="section level3 unnumbered">
<h3>Exercise 1: Conceptual warmup</h3>
<p>LASSO for the logistic regression setting works analogously to the regression setting. How would you expect a plot of test <strong>roc_auc</strong> vs. <span class="math inline">\(\lambda\)</span> to look, and why? (Draw it!)</p>
</div>
<div id="exercise-2-implementing-lasso-logistic-regression-in-tidymodels" class="section level3 unnumbered">
<h3>Exercise 2: Implementing LASSO logistic regression in <code>tidymodels</code></h3>
<p>Fit a LASSO logistic regression model for the <code>spam</code> outcome, and allow all possible predictors to be considered (<code>~ .</code> in the model formula).</p>
<ul>
<li>Use 10-fold CV.</li>
<li>Initially try a sequence of 100 <span class="math inline">\(\lambda\)</span>’s from 1 to 10.
<ul>
<li>Diagnose whether this sequence should be updated by looking at the plot of test AUC vs. <span class="math inline">\(\lambda\)</span>.</li>
<li>If needed, adjust the max or min value in the sequence up or down by a factor of 10. (You’ll be able to determine from the plot whether to adjust up or down.)</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="evaluating-classification-models.html#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb172-2"><a href="evaluating-classification-models.html#cb172-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-3"><a href="evaluating-classification-models.html#cb172-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Make sure you set reference level (to the outcome you are NOT interested in)</span></span>
<span id="cb172-4"><a href="evaluating-classification-models.html#cb172-4" aria-hidden="true" tabindex="-1"></a>spam <span class="ot">&lt;-</span> spam <span class="sc">%&gt;%</span></span>
<span id="cb172-5"><a href="evaluating-classification-models.html#cb172-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">spam =</span> <span class="fu">relevel</span>(<span class="fu">factor</span>(spam), <span class="at">ref=</span><span class="st">&#39;not_spam&#39;</span>)) <span class="co">#set reference level</span></span>
<span id="cb172-6"><a href="evaluating-classification-models.html#cb172-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-7"><a href="evaluating-classification-models.html#cb172-7" aria-hidden="true" tabindex="-1"></a>data_cv10 <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(spam, <span class="at">v =</span> <span class="dv">10</span>)</span>
<span id="cb172-8"><a href="evaluating-classification-models.html#cb172-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-9"><a href="evaluating-classification-models.html#cb172-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-10"><a href="evaluating-classification-models.html#cb172-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Logistic LASSO Regression Model Spec</span></span>
<span id="cb172-11"><a href="evaluating-classification-models.html#cb172-11" aria-hidden="true" tabindex="-1"></a>logistic_lasso_spec_tune <span class="ot">&lt;-</span> <span class="fu">logistic_reg</span>() <span class="sc">%&gt;%</span></span>
<span id="cb172-12"><a href="evaluating-classification-models.html#cb172-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_engine</span>(<span class="st">&#39;glmnet&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb172-13"><a href="evaluating-classification-models.html#cb172-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_args</span>(<span class="at">mixture =</span> <span class="dv">1</span>, <span class="at">penalty =</span> <span class="fu">tune</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb172-14"><a href="evaluating-classification-models.html#cb172-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_mode</span>(<span class="st">&#39;classification&#39;</span>)</span>
<span id="cb172-15"><a href="evaluating-classification-models.html#cb172-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-16"><a href="evaluating-classification-models.html#cb172-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Recipe</span></span>
<span id="cb172-17"><a href="evaluating-classification-models.html#cb172-17" aria-hidden="true" tabindex="-1"></a>logistic_rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(_____, <span class="at">data =</span> spam) <span class="sc">%&gt;%</span></span>
<span id="cb172-18"><a href="evaluating-classification-models.html#cb172-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb172-19"><a href="evaluating-classification-models.html#cb172-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>())</span>
<span id="cb172-20"><a href="evaluating-classification-models.html#cb172-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-21"><a href="evaluating-classification-models.html#cb172-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Workflow (Recipe + Model)</span></span>
<span id="cb172-22"><a href="evaluating-classification-models.html#cb172-22" aria-hidden="true" tabindex="-1"></a>log_lasso_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb172-23"><a href="evaluating-classification-models.html#cb172-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_recipe</span>(logistic_rec) <span class="sc">%&gt;%</span></span>
<span id="cb172-24"><a href="evaluating-classification-models.html#cb172-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_model</span>(logistic_lasso_spec_tune) </span>
<span id="cb172-25"><a href="evaluating-classification-models.html#cb172-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-26"><a href="evaluating-classification-models.html#cb172-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Tune Model (trying a variety of values of Lambda penalty)</span></span>
<span id="cb172-27"><a href="evaluating-classification-models.html#cb172-27" aria-hidden="true" tabindex="-1"></a>penalty_grid <span class="ot">&lt;-</span> <span class="fu">grid_regular</span>(</span>
<span id="cb172-28"><a href="evaluating-classification-models.html#cb172-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">penalty</span>(<span class="at">range =</span> <span class="fu">c</span>(__,__)), <span class="co">#log10 transformed </span></span>
<span id="cb172-29"><a href="evaluating-classification-models.html#cb172-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="dv">100</span>)</span>
<span id="cb172-30"><a href="evaluating-classification-models.html#cb172-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-31"><a href="evaluating-classification-models.html#cb172-31" aria-hidden="true" tabindex="-1"></a>tune_output <span class="ot">&lt;-</span> <span class="fu">tune_grid</span>( </span>
<span id="cb172-32"><a href="evaluating-classification-models.html#cb172-32" aria-hidden="true" tabindex="-1"></a>  log_lasso_wf, <span class="co"># workflow</span></span>
<span id="cb172-33"><a href="evaluating-classification-models.html#cb172-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">resamples =</span> data_cv10, <span class="co"># cv folds</span></span>
<span id="cb172-34"><a href="evaluating-classification-models.html#cb172-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">metrics =</span> <span class="fu">metric_set</span>(roc_auc,accuracy),</span>
<span id="cb172-35"><a href="evaluating-classification-models.html#cb172-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">control_resamples</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>, <span class="at">event_level =</span> <span class="st">&#39;second&#39;</span>),</span>
<span id="cb172-36"><a href="evaluating-classification-models.html#cb172-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">grid =</span> penalty_grid <span class="co"># penalty grid defined above</span></span>
<span id="cb172-37"><a href="evaluating-classification-models.html#cb172-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb172-38"><a href="evaluating-classification-models.html#cb172-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-39"><a href="evaluating-classification-models.html#cb172-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize Model Evaluation Metrics from Tuning</span></span>
<span id="cb172-40"><a href="evaluating-classification-models.html#cb172-40" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(tune_output) <span class="sc">+</span> <span class="fu">theme_classic</span>()</span></code></pre></div>
</div>
<div id="exercise-3-inspecting-the-model" class="section level3 unnumbered">
<h3>Exercise 3: Inspecting the model</h3>
<ol style="list-style-type: lower-alpha">
<li>Inspect the plot of CV AUC vs. <span class="math inline">\(\lambda\)</span> once more (after adjusting the penalty grid).</li>
</ol>
<p>Is anything surprising about the results relative to your expectations from Exercise 1? Brainstorm some possible explanations in consideration of the data context.</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="evaluating-classification-models.html#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize Model Evaluation Metrics from Tuning</span></span>
<span id="cb173-2"><a href="evaluating-classification-models.html#cb173-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(tune_output) <span class="sc">+</span> <span class="fu">theme_classic</span>()</span></code></pre></div>
<ol start="2" style="list-style-type: lower-alpha">
<li>Choose a final model whose CV AUC is within one standard error of the overall best metric. Comment on the variables that are removed from the model.</li>
</ol>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="evaluating-classification-models.html#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select Penalty</span></span>
<span id="cb174-2"><a href="evaluating-classification-models.html#cb174-2" aria-hidden="true" tabindex="-1"></a>best_se_penalty <span class="ot">&lt;-</span> <span class="fu">select_by_one_std_err</span>(tune_output, <span class="at">metric =</span> <span class="st">&#39;roc_auc&#39;</span>, <span class="fu">desc</span>(penalty)) <span class="co"># choose penalty value based on the largest penalty within 1 se of the highest CV roc_auc</span></span>
<span id="cb174-3"><a href="evaluating-classification-models.html#cb174-3" aria-hidden="true" tabindex="-1"></a>best_se_penalty</span>
<span id="cb174-4"><a href="evaluating-classification-models.html#cb174-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-5"><a href="evaluating-classification-models.html#cb174-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit Final Model</span></span>
<span id="cb174-6"><a href="evaluating-classification-models.html#cb174-6" aria-hidden="true" tabindex="-1"></a>final_fit_se <span class="ot">&lt;-</span> <span class="fu">finalize_workflow</span>(log_lasso_wf, best_se_penalty) <span class="sc">%&gt;%</span> <span class="co"># incorporates penalty value to workflow </span></span>
<span id="cb174-7"><a href="evaluating-classification-models.html#cb174-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fit</span>(<span class="at">data =</span> spam)</span>
<span id="cb174-8"><a href="evaluating-classification-models.html#cb174-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-9"><a href="evaluating-classification-models.html#cb174-9" aria-hidden="true" tabindex="-1"></a>final_fit_se <span class="sc">%&gt;%</span> <span class="fu">tidy</span>()</span></code></pre></div>
<ol start="3" style="list-style-type: lower-alpha">
<li>Comment on the variable importance based on the how long a variable stayed in the model. Connect the output to the data context.</li>
</ol>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="evaluating-classification-models.html#cb175-1" aria-hidden="true" tabindex="-1"></a>glmnet_output <span class="ot">&lt;-</span> final_fit_se <span class="sc">%&gt;%</span> <span class="fu">extract_fit_engine</span>()</span>
<span id="cb175-2"><a href="evaluating-classification-models.html#cb175-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb175-3"><a href="evaluating-classification-models.html#cb175-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a boolean matrix (predictors x lambdas) of variable exclusion</span></span>
<span id="cb175-4"><a href="evaluating-classification-models.html#cb175-4" aria-hidden="true" tabindex="-1"></a>bool_predictor_exclude <span class="ot">&lt;-</span> glmnet_output<span class="sc">$</span>beta<span class="sc">==</span><span class="dv">0</span></span>
<span id="cb175-5"><a href="evaluating-classification-models.html#cb175-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-6"><a href="evaluating-classification-models.html#cb175-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over each variable</span></span>
<span id="cb175-7"><a href="evaluating-classification-models.html#cb175-7" aria-hidden="true" tabindex="-1"></a>var_imp <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">seq_len</span>(<span class="fu">nrow</span>(bool_predictor_exclude)), <span class="cf">function</span>(row) {</span>
<span id="cb175-8"><a href="evaluating-classification-models.html#cb175-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract coefficient path (sorted from highest to lowest lambda)</span></span>
<span id="cb175-9"><a href="evaluating-classification-models.html#cb175-9" aria-hidden="true" tabindex="-1"></a>    this_coeff_path <span class="ot">&lt;-</span> bool_predictor_exclude[row,]</span>
<span id="cb175-10"><a href="evaluating-classification-models.html#cb175-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute and return the # of lambdas until this variable is out forever</span></span>
<span id="cb175-11"><a href="evaluating-classification-models.html#cb175-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ncol</span>(bool_predictor_exclude) <span class="sc">-</span> <span class="fu">which.min</span>(this_coeff_path) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb175-12"><a href="evaluating-classification-models.html#cb175-12" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb175-13"><a href="evaluating-classification-models.html#cb175-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-14"><a href="evaluating-classification-models.html#cb175-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a dataset of this information and sort</span></span>
<span id="cb175-15"><a href="evaluating-classification-models.html#cb175-15" aria-hidden="true" tabindex="-1"></a>var_imp_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb175-16"><a href="evaluating-classification-models.html#cb175-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">var_name =</span> <span class="fu">rownames</span>(bool_predictor_exclude),</span>
<span id="cb175-17"><a href="evaluating-classification-models.html#cb175-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">var_imp =</span> var_imp</span>
<span id="cb175-18"><a href="evaluating-classification-models.html#cb175-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb175-19"><a href="evaluating-classification-models.html#cb175-19" aria-hidden="true" tabindex="-1"></a>var_imp_data <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(var_imp))</span></code></pre></div>
</div>
<div id="exercise-4-interpreting-evaluation-metrics" class="section level3 unnumbered">
<h3>Exercise 4: Interpreting evaluation metrics</h3>
<p>Inspect the overall CV results for the “best” <span class="math inline">\(\lambda\)</span>, and compute the no-information rate (NIR):</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="evaluating-classification-models.html#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CV results for &quot;best lambda&quot;</span></span>
<span id="cb176-2"><a href="evaluating-classification-models.html#cb176-2" aria-hidden="true" tabindex="-1"></a>tune_output <span class="sc">%&gt;%</span></span>
<span id="cb176-3"><a href="evaluating-classification-models.html#cb176-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span></span>
<span id="cb176-4"><a href="evaluating-classification-models.html#cb176-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(penalty <span class="sc">==</span> best_se_penalty <span class="sc">%&gt;%</span> <span class="fu">pull</span>(penalty))</span>
<span id="cb176-5"><a href="evaluating-classification-models.html#cb176-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-6"><a href="evaluating-classification-models.html#cb176-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Count up number of spam and not_spam emails in the training data</span></span>
<span id="cb176-7"><a href="evaluating-classification-models.html#cb176-7" aria-hidden="true" tabindex="-1"></a>spam <span class="sc">%&gt;%</span></span>
<span id="cb176-8"><a href="evaluating-classification-models.html#cb176-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(spam) <span class="co"># Name of the outcome variable goes inside count()</span></span>
<span id="cb176-9"><a href="evaluating-classification-models.html#cb176-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-10"><a href="evaluating-classification-models.html#cb176-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the NIR</span></span></code></pre></div>
<ul>
<li>Why is an AUC of 1 the best possible value for this metric? How does the AUC for our spam model look relative to this best value?</li>
</ul>
</div>
<div id="exercise-5-using-the-final-model-choosing-a-threshold" class="section level3 unnumbered">
<h3>Exercise 5: Using the final model (choosing a threshold)</h3>
<p>Once we’ve used LASSO to do model selection (to balance bias and variance), we need to use the final model to make predictions.</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="evaluating-classification-models.html#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Soft Predictions on Training Data</span></span>
<span id="cb177-2"><a href="evaluating-classification-models.html#cb177-2" aria-hidden="true" tabindex="-1"></a>final_output <span class="ot">&lt;-</span> final_fit_se <span class="sc">%&gt;%</span> <span class="fu">predict</span>(<span class="at">new_data =</span> spam, <span class="at">type=</span><span class="st">&#39;prob&#39;</span>) <span class="sc">%&gt;%</span> <span class="fu">bind_cols</span>(spam)</span></code></pre></div>
<ol style="list-style-type: lower-alpha">
<li>Make an ROC curve of the sensitivity and specificity for the final model. First, consider sensitivity and specificity - what do these numbers mean? Do you think higher sensitivity or specificity would be more important in designing a spam filter? Comment about the shape of the ROC curve and what that tells you about the model.</li>
</ol>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="evaluating-classification-models.html#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use soft predictions</span></span>
<span id="cb178-2"><a href="evaluating-classification-models.html#cb178-2" aria-hidden="true" tabindex="-1"></a>final_output <span class="sc">%&gt;%</span></span>
<span id="cb178-3"><a href="evaluating-classification-models.html#cb178-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">roc_curve</span>(spam,.pred_spam,<span class="at">event_level =</span> <span class="st">&#39;second&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb178-4"><a href="evaluating-classification-models.html#cb178-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">autoplot</span>()</span></code></pre></div>
<ol start="2" style="list-style-type: lower-alpha">
<li>Similar to the ROC curve, we can calculate the sensitivity and specificity for a variety of threshold values. Then we will calculate two measures.</li>
</ol>
<ul>
<li>J index: sensitivity + specificity - 1</li>
<li>distance (Euclidean distance to [false positive = 0, sens = 1]): (1 - sensitivity) ^ 2 + (1 - specificity) ^ 2</li>
</ul>
<p>We can use these measures to help us choose an optimal threshold.</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="evaluating-classification-models.html#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="co"># thresholds in terms of reference level</span></span>
<span id="cb179-2"><a href="evaluating-classification-models.html#cb179-2" aria-hidden="true" tabindex="-1"></a>threshold_output <span class="ot">&lt;-</span> final_output <span class="sc">%&gt;%</span></span>
<span id="cb179-3"><a href="evaluating-classification-models.html#cb179-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">threshold_perf</span>(<span class="at">truth =</span> spam, <span class="at">estimate =</span> .pred_not_spam, <span class="at">thresholds =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">by=</span>.<span class="dv">01</span>)) </span>
<span id="cb179-4"><a href="evaluating-classification-models.html#cb179-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-5"><a href="evaluating-classification-models.html#cb179-5" aria-hidden="true" tabindex="-1"></a><span class="co"># J-index v. threshold for not_spam</span></span>
<span id="cb179-6"><a href="evaluating-classification-models.html#cb179-6" aria-hidden="true" tabindex="-1"></a>threshold_output <span class="sc">%&gt;%</span></span>
<span id="cb179-7"><a href="evaluating-classification-models.html#cb179-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">&#39;j_index&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb179-8"><a href="evaluating-classification-models.html#cb179-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> .threshold, <span class="at">y =</span> .estimate)) <span class="sc">+</span></span>
<span id="cb179-9"><a href="evaluating-classification-models.html#cb179-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb179-10"><a href="evaluating-classification-models.html#cb179-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&#39;J-index&#39;</span>, <span class="at">x =</span> <span class="st">&#39;threshold&#39;</span>) <span class="sc">+</span></span>
<span id="cb179-11"><a href="evaluating-classification-models.html#cb179-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>()</span>
<span id="cb179-12"><a href="evaluating-classification-models.html#cb179-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-13"><a href="evaluating-classification-models.html#cb179-13" aria-hidden="true" tabindex="-1"></a>threshold_output <span class="sc">%&gt;%</span></span>
<span id="cb179-14"><a href="evaluating-classification-models.html#cb179-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">&#39;j_index&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb179-15"><a href="evaluating-classification-models.html#cb179-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(.estimate))</span>
<span id="cb179-16"><a href="evaluating-classification-models.html#cb179-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-17"><a href="evaluating-classification-models.html#cb179-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-18"><a href="evaluating-classification-models.html#cb179-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Distance v. threshold for not_spam</span></span>
<span id="cb179-19"><a href="evaluating-classification-models.html#cb179-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-20"><a href="evaluating-classification-models.html#cb179-20" aria-hidden="true" tabindex="-1"></a>threshold_output <span class="sc">%&gt;%</span></span>
<span id="cb179-21"><a href="evaluating-classification-models.html#cb179-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">&#39;distance&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb179-22"><a href="evaluating-classification-models.html#cb179-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> .threshold, <span class="at">y =</span> .estimate)) <span class="sc">+</span></span>
<span id="cb179-23"><a href="evaluating-classification-models.html#cb179-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb179-24"><a href="evaluating-classification-models.html#cb179-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&#39;Distance&#39;</span>, <span class="at">x =</span> <span class="st">&#39;threshold&#39;</span>) <span class="sc">+</span></span>
<span id="cb179-25"><a href="evaluating-classification-models.html#cb179-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>()</span>
<span id="cb179-26"><a href="evaluating-classification-models.html#cb179-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-27"><a href="evaluating-classification-models.html#cb179-27" aria-hidden="true" tabindex="-1"></a>threshold_output <span class="sc">%&gt;%</span></span>
<span id="cb179-28"><a href="evaluating-classification-models.html#cb179-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">&#39;distance&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb179-29"><a href="evaluating-classification-models.html#cb179-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(.estimate)</span>
<span id="cb179-30"><a href="evaluating-classification-models.html#cb179-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-31"><a href="evaluating-classification-models.html#cb179-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-32"><a href="evaluating-classification-models.html#cb179-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-33"><a href="evaluating-classification-models.html#cb179-33" aria-hidden="true" tabindex="-1"></a>log_metrics <span class="ot">&lt;-</span> <span class="fu">metric_set</span>(accuracy,sens,yardstick<span class="sc">::</span>spec)</span>
<span id="cb179-34"><a href="evaluating-classification-models.html#cb179-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-35"><a href="evaluating-classification-models.html#cb179-35" aria-hidden="true" tabindex="-1"></a>final_output <span class="sc">%&gt;%</span></span>
<span id="cb179-36"><a href="evaluating-classification-models.html#cb179-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">.pred_class =</span> <span class="fu">make_two_class_pred</span>(.pred_not_spam, <span class="fu">levels</span>(spam), <span class="at">threshold =</span> ___ )) <span class="sc">%&gt;%</span></span>
<span id="cb179-37"><a href="evaluating-classification-models.html#cb179-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log_metrics</span>(<span class="at">truth =</span> spam, <span class="at">estimate =</span> .pred_class, <span class="at">event_level =</span> <span class="st">&#39;second&#39;</span>)</span></code></pre></div>
<p>Choose a threshold and interpret overall accuracy - does this seem high? How can the no-information rate (NIR) help us interpret the overall accuracy?</p>
<ol start="3" style="list-style-type: lower-alpha">
<li>There are data contexts in which you might want to weigh the relative cost of a false negative to a false positive and incorporate that into your choice of threshold.</li>
</ol>
<p>In this case you can specify:</p>
<ul>
<li><span class="math inline">\(cost\)</span>, the relative cost of a false negative classification (as compared with a false positive classification)</li>
<li><span class="math inline">\(prev\)</span>, the prevalence, or the proportion of positive cases in the population</li>
</ul>
<p>and calculate</p>
<p><span class="math display">\[r = \frac{1-prev}{cost*prev}\]</span>
This value <span class="math inline">\(r\)</span> gives a measure of the relative cost of false positives to false negatives, weighting by the frequency of the two groups. If <span class="math inline">\(cost = 1\)</span> and <span class="math inline">\(prev = 0.5\)</span>, <span class="math inline">\(r=1\)</span>.</p>
<p>Then we can update our two measures,</p>
<ul>
<li>Weighted J index: sensitivity + r*specificity - 1</li>
<li>Weighted distance: (1 - sensitivity) ^ 2 + r*(1 - specificity) ^ 2</li>
</ul>
<p><strong>Computational Thinking Exercise</strong>: If you were to implement these weighted measures (j-index and distance), how would you go about using the following ROC output to calculate the measures and find the optimal threshold. Write our the steps in words using the names of functions you might use, but don’t actually code it up.</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="evaluating-classification-models.html#cb180-1" aria-hidden="true" tabindex="-1"></a>final_output <span class="sc">%&gt;%</span></span>
<span id="cb180-2"><a href="evaluating-classification-models.html#cb180-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">roc_curve</span>(spam,.pred_spam,<span class="at">event_level =</span> <span class="st">&#39;second&#39;</span>)</span></code></pre></div>
</div>
<div id="exercise-6-algorithmic-understanding-for-evaluation-metrics" class="section level3 unnumbered">
<h3>Exercise 6: Algorithmic understanding for evaluation metrics</h3>
<p>Inspect the iteration specific information from tuning the LASSO model (focus on the “best” penalty term).</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="evaluating-classification-models.html#cb181-1" aria-hidden="true" tabindex="-1"></a>tune_output <span class="sc">%&gt;%</span> <span class="fu">collect_metrics</span>(<span class="at">summarize =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(penalty <span class="sc">==</span> best_se_penalty <span class="sc">%&gt;%</span> <span class="fu">pull</span>(penalty))</span></code></pre></div>
<p>How is one row of information computed? Carefully describe (in words) the CV process for a single iteration to estimate each of CV <code>roc_auc</code> and <code>accuracy</code> (overall accuracy). Use a generic confusion matrix (filled with TP, TP, FP, FN instead of hard numbers) to illustrate the underlying computations.</p>

</div>
</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="logistic-regression-evaluation.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="homework-1.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
